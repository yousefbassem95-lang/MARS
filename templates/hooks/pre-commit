#!/bin/bash

# --- THE ARCHITECT'S GUARDIAN (PRE-COMMIT) ---
# 1. Identity Check
EXPECTED_NAME="Youssef Bassem"
EXPECTED_EMAIL="Yousefbassem95@Gmail.com"
EXPECTED_KEY="61CC6B967A1AF5EB"

ACTUAL_NAME=$(git config user.name)
ACTUAL_EMAIL=$(git config user.email)
ACTUAL_KEY=$(git config user.signingkey)

if [[ "$ACTUAL_NAME" != "$EXPECTED_NAME" || "$ACTUAL_EMAIL" != "$EXPECTED_EMAIL" || "$ACTUAL_KEY" != "$EXPECTED_KEY" ]]; then
    echo "❌ ERROR: Identity Mismatch! You are not the Architect."
    echo "Expected: $EXPECTED_NAME <$EXPECTED_EMAIL> (Key: $EXPECTED_KEY)"
    echo "Actual:   $ACTUAL_NAME <$ACTUAL_EMAIL> (Key: $ACTUAL_KEY)"
    exit 1
fi

# 2. Secret Scanning (Basic)
SECRETS_PATTERN="password|secret|aws_key|api_key|private_key|token"
if git diff --cached --name-only | xargs grep -iE "$SECRETS_PATTERN" /dev/null; then
    echo "❌ ERROR: Potential secrets detected in staged files!"
    echo "Please remove sensitive data before committing."
    exit 1
fi

echo "✅ Guardian passed. Proceeding with commit..."
